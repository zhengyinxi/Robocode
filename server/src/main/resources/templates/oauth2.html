<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Demo</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width"/>
    <base th:href="@{/}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}"/>
</head>
<body ng-app="app" ng-controller="home as home">
<h1>Login</h1>
<div class="container" ng-show="!home.authenticated">
    <div>
        With Facebook: <a th:href="@{/login/facebook}">click here</a>
    </div>
    <div>
        With Github: <a th:href="@{/login/github}">click here</a>
    </div>
    <div>
        With microsoft: <a th:href="@{/login/microsoft}">click here</a>
    </div>
</div>
<div class="container" ng-show="home.authenticated">
    Logged in as: <span ng-bind="home.user"></span>
    <div>
        <button ng-click="home.logout()" class="btn btn-primary">Logout</button>
    </div>
</div>
<script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/webjars/angularjs/angular.min.js}"></script>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    angular.module("app", [])
            .controller("home", function ($http, $location) {
                var self = this;
                $http.get(/*[[@{/user}]]*/).success(function (data) {
                    if (data.name) {
                        self.user = data.name;
                        self.authenticated = true;
                    } else {
                        self.user = "N/A";
                        self.authenticated = false;
                    }
                }).error(function () {
                    self.user = "N/A";
                    self.authenticated = false;
                });
                self.logout = function () {
                    $http.post('logout', {}).success(function () {
                        self.authenticated = false;
                        //$location.path(/*[[@{/}]]*/);
                    }).error(function (data) {
                        console.log("Logout failed")
                        self.authenticated = false;
                    });
                };
            });
    /*]]>*/
</script>
</body>
</html>
